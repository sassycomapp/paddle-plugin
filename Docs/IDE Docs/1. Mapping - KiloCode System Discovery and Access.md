# KiloCode System Discovery and Access Mapping

Based on my comprehensive analysis of the paddle-plugin VSCode Agentic IDE system, here's a clear mapping of how KiloCode discovers and accesses the integrated systems and MCPs:

## üéØ System Architecture Overview

The paddle-plugin system is a semi-autonomous Agentic IDE with KiloCode as the main UI interface and AG2 (AutoGen2) as the orchestration layer, supported by a comprehensive ecosystem of MCP (Model Context Protocol) servers and integrated systems.

## üìÅ KiloCode Configuration Discovery

### Primary Configuration Files

KiloCode discovers system configurations through these key files:

1. **`.kilocode/mcp.json`** - Main MCP server configuration
			-> Now updated to include 21 MCPs
   - Defines 10+ MCP servers with commands, arguments, and environment variables
   - Includes filesystem, GitHub, PostgreSQL, RAG, memory, and custom servers

2. **`.kilocode/config/services.yaml`** - Service management configuration
   - Organizes services into: core_services, custom_services, external_services
   - Defines dependencies, health checks, restart policies, and monitoring

3. **`.kilocode/integration/mcp-server-manager.js`** - MCP server lifecycle manager
   - Handles server initialization, startup, shutdown, and health monitoring
   - Manages service dependencies and graceful shutdown procedures

## üîß MCP Server Discovery and Access

### Core MCP Servers (10+ Servers) 

#### **File System Operations**
- **Server**: `filesystem` (MCP standard)
- **Tools**: `file_operations`, `directory_listing`
- **Access**: Direct file system operations with project path awareness

#### **Database Operations**
- **Server**: `postgres` (MCP standard)
- **Tools**: `query`, `schema_management`
- **Access**: PostgreSQL with connection string `postgresql://postgres:2001@localhost:5432/postgres`

#### **Memory Management**
- **Server**: `agent-memory` (Custom)
  - **Tools**: 16 memory tools including episodic, semantic, and working memory
  - **Access**: PostgreSQL backend with pgvector extension for vector operations

- **Server**: `mcp-memory-service` (Custom)
  - **Tools**: Memory consolidation, clustering, and advanced management
  - **Access**: Python-based service with ChromaDB/SQLite backends

#### **Knowledge Management**
- **Server**: `rag-mcp-server` (Custom)
- **Tools**: `semantic_search`, `knowledge_retrieval`
- **Access**: Vector database integration for RAG workflows

#### **Development Tools**
- **Server**: `testing-validation` (Custom)
  - **Tools**: `run_tests`, `validate_results`
  - **Access**: Database-backed testing framework

- **Server**: `logging-telemetry-mcp` (Custom)
  - **Tools**: `log_retrieval`, `telemetry_collection`
  - **Access**: Structured logging with monitoring capabilities

#### **External Services**
- **Server**: `github` (MCP standard)
  - **Tools**: `github_search`, `repo_management`
  - **Access**: GitHub API integration

- **Server**: `fetch` (Custom)
  - **Tools**: `http_get`, `http_post`
  - **Access**: HTTP request handling

- **Server**: `EverythingSearchMCPServer` (Custom)
  - **Tools**: Local file system search
  - **Access**: Windows Everything Search integration

## üß† Memory System Architecture

### Multi-Tiered Memory System

The system implements a sophisticated memory architecture with three tiers:

1. **Episodic Memory**: Stores events and interactions with PostgreSQL backend
2. **Semantic Memory**: Stores knowledge and facts with vector embeddings
3. **Working Memory**: Temporary session-based state management

### Memory Access Flow

```
User Request ‚Üí KiloCode ‚Üí MCP Tool Selection ‚Üí Memory Service ‚Üí 
PostgreSQL/Vector DB ‚Üí Response Generation
```

## üîÑ AG2 Orchestration Integration

### AG2 System Architecture
- **Deployment Modes**: Pure Python, Lite, Full
- **Agents**: Researcher, Coordinator, Analyst
- **Core Components**: Memory, RAG, Search services

### Integration Pattern

```
User Task ‚Üí KiloCode (Analysis) ‚Üí AG2 Selection ‚Üí 
Agent Coordination ‚Üí MCP Tool Execution ‚Üí Result Compilation
```

## üìä System Discovery Process

### 1. Configuration Loading

```javascript
// KiloCode loads configurations in order:
1. .kilocode/mcp.json (MCP server definitions)
2. .kilocode/config/services.yaml (Service management)
3. .kilocode/config/environment.yaml (Environment settings)
```

### 2. Service Initialization

```javascript
// MCP Server Manager Process:
1. Validate environment and dependencies
2. Load server configurations
3. Start services in dependency order
4. Monitor health and status
5. Handle graceful shutdown
```

### 3. Tool Discovery

```javascript
// Tool Access Pattern:
1. User issues task to KiloCode
2. KiloCode analyzes task requirements
3. Selects appropriate MCP server based on task type
4. Executes specific tool with required arguments
5. Returns results to user
```

## üéØ Task Execution Flow

### Complete Workflow Example

```
User: "Analyze the system performance and create a report"

1. KiloCode reads .kilocode configuration files
2. Determines need for: logging analysis, database queries, report generation
3. Selects MCP servers:
   - logging-telemetry-mcp (for log analysis)
   - postgres (for database metrics)
   - filesystem (for report creation)
4. Coordinates with AG2 for complex analysis
5. Executes tools in appropriate sequence
6. Compiles and presents results
```

## üîç System Access Patterns

### Direct MCP Tool Access

```xml
<use_mcp_tool>
<server_name>agent-memory</server_name>
<tool_name>retrieve_episodic_memory</tool_name>
<arguments>
{"agent_id": "kilocode", "session_id": "current"}
</arguments>
</use_mcp_tool>
```

### AG2-Coordinated Access

```javascript
// KiloCode directs AG2 to orchestrate multiple tools:
1. AG2 selects Researcher agent for information gathering
2. Researcher uses fetch and github tools
3. Coordinator manages workflow and timing
4. Analyst uses postgres and rag tools for analysis
5. Results compiled and presented through KiloCode
```

## üõ°Ô∏è Security and Access Control

### Environment-Based Security
- All MCP servers use environment variables for credentials
- Database connections use connection strings with proper authentication
- File system access is scoped to project directory

### Service Isolation
- Each MCP server runs in isolated process
- Health monitoring prevents service interference
- Graceful shutdown maintains data integrity

## üìà System Monitoring and Health

### Health Check System

```javascript
// Continuous monitoring:
1. Service health checks every 30 seconds
2. Performance metrics collection
3. Error logging and alerting
4. Automatic restart on failure
```

### Performance Optimization
- Connection pooling for database operations
- Vector indexing for fast similarity searches
- Caching layers for frequently accessed data
- Asynchronous processing for concurrent operations

This comprehensive system enables KiloCode to function as a true Agentic IDE, seamlessly discovering and accessing a rich ecosystem of tools and services through the MCP protocol while maintaining robustness, security, and performance.