# Virtual Environments Mapping Document

## Executive Summary

This document provides a comprehensive analysis of the virtual environments within the paddle-plugin system. The analysis reveals several critical issues including duplicate virtual environments, inconsistent configurations, and potential integration problems that need to be addressed.

## Virtual Environment Inventory

### 1. Primary Virtual Environments

#### 1.1 easyocr-env
- **Location**: `C:\_1mybizz\paddle-plugin\easyocr-env`
- **Python Version**: 3.13.3
- **Base Python**: `C:\Python313\python.exe`
- **Configuration**: 
  - `include-system-site-packages = false`
  - Created with: `C:\Python313\python.exe -m venv c:\_1mybizz\paddle-plugin\easyocr-env`
- **Purpose**: Dedicated environment for EasyOCR operations
- **Status**: Active and configured
- **Integration Points**: 
  - Used by `easyocr-mcp` module
  - Environment variable: `EASYOCR_LANGUAGES`
  - Model storage: `C:/easyocr_models`

#### 1.2 venv (Root Level)
- **Location**: `C:\_1mybizz\paddle-plugin\venv`
- **Python Version**: 3.13.3
- **Base Python**: `C:\Python313\python.exe`
- **Configuration**: 
  - `include-system-site-packages = false`
  - Created with: `C:\Python313\python.exe -m venv C:\_1mybizz\paddle-plugin\venv`
- **Purpose**: General development environment
- **Status**: Referenced in VS Code settings
- **Integration Points**:
  - VS Code default interpreter: `${workspaceFolder}/venv/Scripts/python.exe`
  - Used by setup scripts: `setup_python_env.bat`

### 2. Secondary Environment Indicators

#### 2.1 simba Environment
- **Location**: `C:\_1mybizz\paddle-plugin\simba`
- **Python Version**: 3.13.3 (specified in `.python-version`)
- **Management**: Poetry-based
- **Configuration**: `pyproject.toml` with Poetry
- **Purpose**: Knowledge Management System
- **Status**: Uses Poetry for dependency management
- **Integration Points**:
  - CLI tool: `simba`
  - Dependencies: langchain, faiss-cpu, sentence-transformers, etc.

#### 2.2 easyocr-mcp Environment
- **Location**: `C:\_1mybizz\paddle-plugin\easyocr-mcp`
- **Management**: UV-based (pyproject.toml + uv.lock)
- **Python Version**: >=3.13
- **Purpose**: MCP server for EasyOCR integration
- **Status**: UV-managed environment
- **Integration Points**:
  - MCP server integration
  - Environment variable: `EASYOCR_LANGUAGES`

## Critical Issues Identified

### 1. Duplicate Virtual Environments
**Severity**: HIGH
- **Issue**: Multiple virtual environments with identical Python versions (3.13.3)
- **Locations**: 
  - `easyocr-env`
  - `venv`
- **Impact**: 
  - Wasted disk space
  - Potential dependency conflicts
  - Confusion during development
- **Recommendation**: Consolidate into a single environment with proper activation

### 2. Inconsistent Environment Management
**Severity**: MEDIUM
- **Issue**: Mixed environment management approaches:
  - Standard venv (`easyocr-env`, `venv`)
  - Poetry (`simba`)
  - UV (`easyocr-mcp`)
- **Impact**: 
  - Inconsistent dependency management
  - Difficult maintenance
  - Potential version conflicts
- **Recommendation**: Standardize on one approach (Poetry recommended)

### 3. Deeply Nested Dependencies
**Severity**: MEDIUM
- **Issue**: Complex dependency chains in multiple environments
- **Examples**:
  - `easyocr-env`: Contains 100+ packages with complex ML/AI dependencies
  - `simba`: Contains 40+ packages with RAG and vector database dependencies
- **Impact**: 
  - Long installation times
  - Potential conflicts between environments
  - Diff troubleshooting
- **Recommendation**: Create dependency matrix and identify common packages

### 4. Integration Point Confusion
**Severity**: MEDIUM
- **Issue**: Unclear which environment serves which purpose
- **Examples**:
  - Both `easyocr-env` and `easyocr-mcp` handle OCR functionality
  - VS Code points to `venv` but `easyocr-env` is used for OCR
- **Impact**: 
  - Development confusion
  - Potential runtime errors
  - Difficult onboarding
- **Recommendation**: Clear separation of concerns and documentation

## Environment Dependencies Analysis

### 1. easyocr-env Dependencies
```python
# Core OCR dependencies
- easyocr>=1.7.2
- pillow>=8.0.0
- numpy>=1.21.0
- opencv-python>=4.5.0
- pytesseract>=0.3.10

# ML/AI dependencies
- torch>=2.4.0
- torchvision>=0.19.0
- torchaudio>=2.4.0
- sentence-transformers>=3.2.0

# Development tools
- pytest>=7.0.0
- black>=25.1.0
- flake8>=5.0.0
```

### 2. simba Dependencies
```python
# RAG and Knowledge Management
- langchain>=0.3.0
- faiss-cpu>=1.8.0
- sentence-transformers>=3.2.0
- litellm>=1.56.6

# Web Framework
- fastapi>=0.115.0
- uvicorn>=0.33.0

# Database
- psycopg2-binary>=2.9.10
- pgvector>=0.4.1
- redis>=5.2.1
```

### 3. Common Dependencies
```python
# Shared across environments
- python-dotenv>=1.0.0
- pydantic>=2.0.0
- httpx>=0.24.0
- numpy>=1.21.0
- Pillow>=9.0.0
```

## Integration Points Mapping

### 1. MCP Server Integration
- **easyocr-mcp**: Connects to `easyocr-env` for OCR functionality
- **Environment Variables**: `EASYOCR_LANGUAGES`, `EASYOCR_MODEL_STORAGE`
- **Configuration**: MCP server configuration in `.kilocode/mcp.json`

### 2. VS Code Integration
- **Default Interpreter**: `${workspaceFolder}/venv/Scripts/python.exe`
- **Terminal Activation**: `venv\Scripts\activate.bat`
- **Linting/Formatting**: Black configured for `venv`

### 3. System Integration
- **Database**: PostgreSQL connections via `psycopg2-binary`
- **Vector Storage**: FAISS and pgvector for embeddings
- **Cache**: Redis for caching layer
- **Model Storage**: EasyOCR models in `C:/easyocr_models`

## Recommended Actions

### 1. Immediate Actions (High Priority)
1. **Consolidate Virtual Environments**
   - Merge `easyocr-env` and `venv` functionality
   - Create single development environment
   - Update all references

2. **Standardize Environment Management**
   - Adopt Poetry for all Python projects
   - Convert UV and venv projects to Poetry
   - Create consistent dependency management

3. **Clear Integration Points**
   - Document which environment serves which purpose
   - Update MCP configurations
   - Fix VS Code settings

### 2. Medium Priority Actions
1. **Dependency Optimization**
   - Identify and eliminate duplicate dependencies
   - Create dependency matrix
   - Optimize package versions

2. **Environment Documentation**
   - Create environment setup guides
   - Document activation procedures
   - Provide troubleshooting guide

### 3. Long-term Actions
1. **Automated Environment Management**
   - Implement environment provisioning scripts
   - Create CI/CD pipeline for environment setup
   - Add environment validation checks

## Environment Setup Procedures

### 1. Current Setup Process
```bash
# For development environment
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install -r requirements.txt

# For EasyOCR environment
python -m venv easyocr-env
source easyocr-env/bin/activate
pip install -r easyocr-requirements.txt

# For Simba environment
cd simba
poetry install
```

### 2. Recommended Setup Process
```bash
# Single unified environment
poetry env use python3.13
poetry install --with dev,simba,mcp
poetry shell

# Activate environment
poetry shell  # Or use poetry run for specific commands
```

## Troubleshooting Guide

### 1. Common Issues
- **Module Not Found**: Check which environment is activated
- **Version Conflicts**: Use Poetry to manage versions
- **Import Errors**: Verify PYTHONPATH and environment activation

### 2. Environment Validation
```bash
# Check active environment
which python  # Linux/Mac
where python  # Windows

# Verify packages
pip list
poetry show

# Test integration
python -c "import easyocr; print('EasyOCR OK')"
python -c "import langchain; print('LangChain OK')"
```

## Conclusion

The current virtual environment setup has several critical issues that need to be addressed to ensure smooth development and deployment. The primary concerns are duplicate environments, inconsistent management approaches, and unclear integration points. By implementing the recommended actions, the system can be streamlined to improve maintainability, reduce conflicts, and enhance developer productivity.

## Appendix

### A. Environment Configuration Files
- `easyocr-env/pyvenv.cfg`: EasyOCR environment configuration
- `venv/pyvenv.cfg`: Root environment configuration
- `simba/pyproject.toml`: Simba Poetry configuration
- `easyocr-mcp/pyproject.toml`: EasyOCR MCP UV configuration
- `pyproject.toml`: Root Poetry configuration

### B. Environment Variables
- `EASYOCR_LANGUAGES`: Languages for OCR processing
- `EASYOCR_MODEL_STORAGE`: Path to EasyOCR models
- `PYTHONPATH`: Python module search paths
- `VIRTUAL_ENV`: Active virtual environment path

### C. References
- [Python Virtual Environments Documentation](https://docs.python.org/3/library/venv.html)
- [Poetry Documentation](https://python-poetry.org/docs/)
- [UV Documentation](https://docs.astral.sh/uv/)